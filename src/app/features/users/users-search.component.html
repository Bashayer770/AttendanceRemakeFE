<div class="flex flex-col items-center justify-start bg-gray-50 arabic-text">
  <div class="w-full max-w-7xl bg-white shadow-lg px-8 pb-4 rounded-lg">
    <div
      class="bg-primary text-white text-center py-4 rounded-t-lg -mx-8 -mt-2 mb-8"
    >
      <h2 class="text-3xl font-sans arabic-text">بحث الموظف</h2>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSearch()" class="flex gap-2 mb-6">
      <input
        type="text"
        formControlName="query"
        placeholder="أدخل رقم الموظف، رقم البصمة، اسم الدخول، أو الاسم"
        class="w-full px-4 py-3 border-b-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:bg-white hover:bg-slate-100 arabic-text"
      />
      <button
        type="submit"
        class="bg-primary text-white px-6 rounded-lg hover:bg-primary/80"
      >
        بحث
      </button>
    </form>

    <div *ngIf="loading" class="text-center text-gray-500">...جاري البحث</div>
    <div *ngIf="error" class="text-center text-red-600">{{ error }}</div>

    <!-- Two-column layout: left = details, right = fetched user card -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 items-start" dir="ltr">
      <!-- Static details panel (left) -->
      <div class="lg:col-start-1 lg:col-span-1">
        <div
          *ngIf="showDetails"
          class="bg-white border rounded-xl shadow p-5 min-h-[260px]"
          dir="rtl"
        >
          <h3 class="text-xl font-semibold mb-3">تفاصيل الموظف</h3>
          <ng-container *ngIf="vm as d; else noDetails">
            <div class="space-y-2 text-gray-800">
              <div>
                <span class="font-semibold">الاسم:</span> {{ d.name || "-" }}
              </div>
              <div>
                <span class="font-semibold">الرقم الوظيفي:</span>
                {{ d.empNo || "-" }}
              </div>
              <div>
                <span class="font-semibold">الوظيفة:</span> {{ d.role || "-" }}
              </div>
              <div>
                <span class="font-semibold">القسم:</span>
                {{ d.deptName || "-" }}
              </div>
              <div>
                <span class="font-semibold">القطاع:</span>
                {{ d.sectorName || "-" }}
              </div>
              <hr class="my-2" />
              <div class="text-sm text-gray-600">
                <span class="font-semibold">البصمه:</span>
                {{ d.fingerCode ?? "-" }}
              </div>
              <div class="text-sm text-gray-600">
                <span class="font-semibold">فتره الدوام:</span>
                {{ d.timingPlanName || "-" }}
              </div>
              <div class="text-sm text-gray-600">
                <span class="font-semibold">تخفيف:</span>
                {{
                  d.hasAllow === true
                    ? "نعم"
                    : d.hasAllow === false
                    ? "لا"
                    : "-"
                }}
              </div>
              <div class="text-sm text-gray-600">
                <span class="font-semibold">الحاله:</span> {{ d.status ?? "-" }}
              </div>
            </div>
          </ng-container>
          <ng-template #noDetails>
            <div class="text-gray-400">لا توجد تفاصيل للعرض</div>
          </ng-template>
        </div>
      </div>

      <!-- Fetched user card (right) -->
      <div class="lg:col-start-2 lg:col-span-2">
        <div
          *ngIf="vm as r"
          class="border rounded-lg shadow-sm p-4 bg-white cursor-pointer"
          dir="rtl"
          (click)="openDetails()"
        >
          <div class="flex items-center justify-between">
            <div class="text-lg font-semibold">{{ r.name || "-" }}</div>
            <div class="text-sm text-gray-500">
              رقم وظيفي: {{ r.empNo || "-" }}
            </div>
          </div>
          <div class="mt-2 text-gray-700">الوظيفة: {{ r.role || "-" }}</div>
          <div class="mt-1 text-gray-700">القسم: {{ r.deptName || "-" }}</div>
          <div class="mt-1 text-gray-700">
            القطاع: {{ r.sectorName || "-" }}
          </div>
        </div>
        <div
          *ngIf="!vm && !loading && !error"
          class="text-center text-gray-400 py-8"
          dir="rtl"
        >
          لا توجد بيانات
        </div>
      </div>
    </div>
  </div>
</div>
